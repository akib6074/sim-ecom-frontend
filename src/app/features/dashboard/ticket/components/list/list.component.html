<div class="ticket-list">
  <div
    *ngIf="pagination.isLoading"
    fxLayout="row"
    fxLayoutAlign="center center"
    style="height: 400px"
  >
    <mat-spinner color="primary"></mat-spinner>
  </div>

  <div *ngIf="token.isAdmin()">
    <mat-form-field appearance="outline">
      <input
        matInput
        #inputBox
        (keyup)="applyFilter(inputBox.value)"
        placeholder="Search here"
      />
    </mat-form-field>
  </div>
  <mat-table #table [dataSource]="dataSource" matSort>
    <div>
      <ng-container matColumnDef="seriall no.">
        <mat-header-cell *matHeaderCellDef mat-sort-header
          >Serial</mat-header-cell
        >
        <mat-cell *matCellDef="let row; let i = index" data-label="seriall no.">
          {{ i + 1 }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef mat-sort-header
          >Name</mat-header-cell
        >
        <mat-cell *matCellDef="let row" data-label="Name">
          <span fxFlex="50"
            >{{ row.user?.firstName }} {{ row.user?.lastName }}</span
          >
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="mail">
        <mat-header-cell *matHeaderCellDef mat-sort-header
          >E-Mail</mat-header-cell
        >
        <mat-cell *matCellDef="let row" data-label="E-Mail">
          <span fxFlex="50">{{ row.user?.email }}</span>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="mobile">
        <mat-header-cell *matHeaderCellDef mat-sort-header
          >Mobile Number</mat-header-cell
        >
        <mat-cell *matCellDef="let row" data-label="Mobile Number">
          {{ row.user?.phone }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="date">
        <mat-header-cell *matHeaderCellDef mat-sort-header
          >Date</mat-header-cell
        >
        <mat-cell *matCellDef="let row" data-label="Date">
          <span fxFlex="50">{{ row.createAt | date }}</span>
        </mat-cell>
      </ng-container>
    </div>

    <ng-container matColumnDef="ticketDepartment">
      <mat-header-cell *matHeaderCellDef mat-sort-header
        >Department</mat-header-cell
      >
      <mat-cell *matCellDef="let row" data-label="Department">
        {{ row.ticketDepartment.name }}
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="subject">
      <mat-header-cell *matHeaderCellDef mat-sort-header
        >Subject</mat-header-cell
      >
      <mat-cell *matCellDef="let row" data-label="subject">
        {{ row.subject }}
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="issueDetails">
      <mat-header-cell *matHeaderCellDef mat-sort-header
        >Issue Details</mat-header-cell
      >
      <mat-cell *matCellDef="let row; let i = index" data-label="issueDetails">
        <mat-expansion-panel hideToggle>
          <mat-expansion-panel-header>
            <mat-panel-title class="issueDetails">
              {{ row.issueDetails }}
            </mat-panel-title>
          </mat-expansion-panel-header>
            <p>{{ row.issueDetails }}</p>
        </mat-expansion-panel>
        <!-- <span class="issueDetails" fxFlex="80" *ngIf="!status">{{ row.issueDetails }}</span>
        <mat-icon class="see-more" *ngIf="!status" (click)="changeSeeMoreStatus()">
          more_horiz
        </mat-icon>
        <span *ngIf="status">{{ row.issueDetails }}</span>
        <mat-icon class="see-more" *ngIf="status" (click)="changeSeeMoreStatus()">arrow_drop_up</mat-icon> -->
      </mat-cell>
    </ng-container>
    <ng-container *ngIf="token.isAdmin()" matColumnDef="actions">
      <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
      <mat-cell *matCellDef="let row">
        <button [matMenuTriggerFor]="menu" mat-button>
          <mat-icon>code</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button
            mat-raised-button
            class="Pending"
            (click)="changeStatus(row.id, TicketStatus.OnHold)"
          >
            <span class="btn-text"> On Hold </span>
          </button>
          <mat-divider></mat-divider
          ><button
            mat-raised-button
            class="Resolved"
            (click)="changeStatus(row.id, TicketStatus.Resolve)"
          >
            <span class="btn-text"> Resolve </span>
          </button>
          <mat-divider></mat-divider>
          <button
            mat-raised-button
            class="Rejected"
            (click)="changeStatus(row.id, TicketStatus.Reject)"
          >
            <span class="btn-text"> Reject </span>
          </button>
        </mat-menu>
      </mat-cell>
    </ng-container>

    <ng-container *ngIf="token.isOnlyCustomer()" matColumnDef="status">
      <mat-header-cell *matHeaderCellDef mat-sort-header
        >Status</mat-header-cell
      >
      <mat-cell *matCellDef="let row" data-label="issueDetails">
        {{ TicketStatus[row.status] }}
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
  </mat-table>

  <mat-paginator
    [length]="pagination.totalCount"
    [pageSizeOptions]="[10, 20, 30, 40, 50, pagination.totalCount]"
    [pageSize]="pagination.rowsPerPage"
    showFirstLastButtons
  >
  </mat-paginator>
</div>
